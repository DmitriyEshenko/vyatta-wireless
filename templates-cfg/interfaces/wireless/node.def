tag:
priority: 320
type: txt
help: Set wireless network interface
syntax:expression: pattern $VAR(@) "^wlan[1-9]*[0-9]$" \
		   ; "invalid wireless device name"
allowed: /opt/vyatta/sbin/vyatta-interfaces.pl --show=wireless

commit:expression: "$VAR(./type/@)" != "" ; "interface type must be set"

commit:expression: ( "$VAR(./type/@)" == "monitor" || "$VAR(./ssid/@)" != "" ) \
		   ; "SSID must be set"

commit:expression: ( "$VAR(./type/@)" != "access-point" || "$VAR(./channel/@)" != "" ) \
		   ; "channel must be set for access-point"

create: if [ ! -d /sys/class/net/$VAR(@) ]; then
	    sudo /opt/vyatta/sbin/wireless-config.pl --dev=$VAR(@) --create || exit 1
	fi

delete: [ -d /sys/class/net/$VAR(@) ] || exit 0
	sudo /opt/vyatta/sbin/wireless-config.pl --dev=$VAR(@) --delete

end:if [ ${COMMIT_ACTION} = 'SET' -o ${COMMIT_ACTION} = 'ACTIVE' ]; then
       if [ ${COMMIT_ACTION} = 'SET' ]; then
             sudo ip link set $VAR(@) up
       fi
       case "$VAR(./type/@)" in
       access-point)
            case ${COMMIT_ACTION} in
     	    SET) sudo /opt/vyatta/sbin/hostapd-init start $VAR(@) ;;
	    ACTIVE) sudo /opt/vyatta/sbin/hostapd-init reload $VAR(@) ;;
            esac ;;
       station)
            case ${COMMIT_ACTION} in
     	    SET) sudo /opt/vyatta/sbin/wpa_supplicant-init start $VAR(@) ;;
	    ACTIVE) sudo /opt/vyatta/sbin/wpa_supplicant-init reload $VAR(@) ;;
            esac ;;
       esac
       /opt/vyatta/sbin/vyatta-link-detect $VAR(@) on
    fi
