tag:
type: txt
help: Set wireless network interface
syntax:expression: exec \
   "/opt/vyatta/sbin/vyatta-interfaces.pl --dev=$VAR(@) --check=wireless"
allowed: /opt/vyatta/sbin/vyatta-interfaces.pl --show=wireless
commit:expression: ( "$VAR(./type/@)" != "" ) ; "interface type must be set"

create: if [ ! -d /sys/class/net/$VAR(@) ]; then
	    /opt/vyatta/sbin/wireless-config.pl --dev=$VAR(@) --create || exit 1
	fi

delete: [ -d /sys/class/net/$VAR(@) ] || exit 0
	/opt/vyatta/sbin/wireless-config.pl --dev=$VAR(@) --delete

end:if [ ${COMMIT_ACTION} = 'SET' -o ${COMMIT_ACTION} = 'ACTIVE' ]; then
        if [ "$VAR(./type/@)" = "access-point" ]; then
            case ${COMMIT_ACTION} in
     	    SET)  sudo ip link set $VAR(@) up
	          sudo /opt/vyatta/sbin/hostapd-init start $VAR(@) ;;
	    ACTIVE) sudo /opt/vyatta/sbin/hostapd-init reload $VAR(@) ;;
            esac
	else
	    sudo ip link set $VAR(@) down
	    sudo /opt/vyatta/sbin/wireless-config.pl --dev=$VAR(@) \
	    	--set-type $VAR(./type/@)
	    sudo iw dev $VAR(../@) set channel $VAR(./channel/@)
	    sudo ip link set $VAR(@) up
	fi
        /opt/vyatta/sbin/vyatta-link-detect $VAR(@) on
    fi
