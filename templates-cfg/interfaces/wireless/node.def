tag:
type: txt
help: Set wireless network interface
comp_help: Enter wireless network interface name (wlan0 - wlan99)
syntax:expression: pattern $VAR(@) "^wlan[0-9]+$" ; \
	 "Must be (wlan0 - wlan999)"

create: if [ ! -d /sys/class/net/$VAR(@) ]; then
	    if [ -z $VAR(./physical-device) ]; then
	        echo "wireless $VAR(@) physical-device: you must specify physical-device for wireless interface"
		exit 1
	    fi
	    IWTYPE=$VAR(./mode)
	    if [ $IWTYPE = "access-point" ]; then
	      IWTYPE="__ap"
	    fi
	    sudo iw dev $VAR(./physical-device) interface \
		add $VAR(@) type $IWTYPE || exit 1
	fi
	sudo ip link set $VAR(@) up
	/opt/vyatta/sbin/vyatta-link-detect $VAR(@) on

delete: [ -d /sys/class/net/$VAR(@) ] || exit 0
	sudo vyatta-hostapd stop $VAR(@)
        sudo ip link set $VAR(@) down
	sudo iw dev $VAR(@) del

# configure and start access point if necessary
end:  if [ "$VAR(./mode)" = "access-point" ] && \
         [ ${COMMIT_ACTION} = 'SET' -o ${COMMIT_ACTION} = 'ACTIVE' ]
      then
           vyatta-hostapd-config $VAR(@)
	   if [ ${COMMIT_ACTION} = 'SET' ]
	   then vyatta-hostapd start $VAR(@)
	   else vyatta-hostapd reload $VAR(@)
	   fi
      fi
