priority: 322
help: Add this interface to a bridge group

commit:expression: "$VAR(./bridge/@)" != "" ; "bridge name must be set"

end:
    wlan=$VAR(../@)
    oldbridge=`/opt/vyatta/sbin/vyatta-cli-expand-var.pl \\$VAR\(/interfaces/wireless/$wlan/bridge-group/bridge/@\)`
    newbridge="$VAR(./bridge/@)"
    if [ ${COMMIT_ACTION} = 'DELETE' ]; then
	sudo brctl delif $oldbridge $wlan
    elif [ ${COMMIT_ACTION} = 'SET' ]; then
        if [ "$oldbridge" != "$newbridge" ] ; then
	   [ -n "$oldbridge" ] 	&& sudo brctl delif $oldbridge $wlan
	   sudo brctl addif $newbridge $wlan
	fi
	cost="$VAR(./cost/@)"
	[ -n "$cost" ] && sudo brctl setpathcost $newbridge $wlan $cost
	prio="$VAR(./priority/@)"
	[ -n "$prio" ] && sudo brctl setportprio $newbridge $wlan $prio
    fi



